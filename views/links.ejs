<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Meus Links</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</head>

<body class="bg-light">
    <%- include('partials/header.ejs') %>
        <div class="container py-5">
            <h1 class="mb-4">Meus Links Encurtados</h1>

            <!-- Lista de links -->
            <div class="row row-cols-1 g-4">

                <% if(links){ %>

                    <% links.forEach((link)=>{ %>

                        <div class="col">
                            <div class="card shadow-sm d-flex flex-row align-items-center">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <%= link.title %>
                                    </h5>
                                    <p class="card-text mb-1"><strong>Original:</strong> <a
                                            href="<%= link.original_link %>" target="_blank">Link Antigo</a></p>
                                    <p class="card-text mb-1"><strong>Label:</strong>
                                        <span id="label"><%= link.label %></span>
                                    </p>
                                    <p class="card-text mb-1"><strong>Cliques:</strong>
                                        <%= link.clicks %>
                                    </p>
                                    <p class="card-text text-muted"><strong>Criado em:</strong>
                                        <%= link.createdAt %>
                                    </p>
                                </div>
                                <div>
                                    <input type="button" value="Delete" idlink="<%= link.idlink %>" class="btn btn-danger m-2 delete-btn">
                                    <input type="button" value="Copiar" label="<%= link.label %>" class="btn btn-success m-2 copy-btn">
                                </div>
                            </div>
                        </div>

                    <% }) %>
                <% } else { %>
                <strong>Não há links para listar</strong>
                <% } %>
            </div>

        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
    $(document).on('click', '.delete-btn', function (e) {
        const id = $(this).attr('idlink')
        $.ajax({
            method: 'DELETE',
            url: `/delete/${id}`,
            success: (data) => {
                alert(data.msg)
                location.reload()
            }
        })
    })
    $(document).on('click', '.copy-btn', function(e){
        const txt = `${location.protocol}://${location.host}/${$(this).attr('label')}`
        navigator.clipboard.writeText(txt)
        .then(() => {
            alert('Link copiado')
        })
        .catch(err => {
        console.error("Erro ao copiar");
        });
    })
</script>

</html>